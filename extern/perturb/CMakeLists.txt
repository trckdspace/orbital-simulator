cmake_minimum_required(VERSION 3.14)

# Partially generated by `cmake-init`

# ---- In-source guard ----
if(CMAKE_SOURCE_DIR STREQUAL CMAKE_BINARY_DIR)
  message(FATAL_ERROR "In-source builds are not supported.")
endif()

project(
    perturb
    VERSION 1.0.0
    DESCRIPTION "A modern C++ wrapper for SGP4 orbit propagation"
    HOMEPAGE_URL "https://github.com/gunvirranu/perturb"
    LANGUAGES CXX
)

option(perturb_DISABLE_IO "Disable I/O and string functionality" OFF)

# For CMake 3.21+, variable is set by default by project()
if(CMAKE_VERSION VERSION_LESS 3.21.0)
    string(
        COMPARE EQUAL
        "${CMAKE_SOURCE_DIR}" "${PROJECT_SOURCE_DIR}"
        PROJECT_IS_TOP_LEVEL
    )
endif()

# ---- Developer mode ----

if(PROJECT_IS_TOP_LEVEL)
    option(perturb_DEVELOPER_MODE "Enable developer mode" OFF)
endif()

# ---- Warning guard ----

# target_include_directories with the SYSTEM modifier will request the compiler
# to omit warnings from the provided paths, if the compiler supports that
# This is to provide a user experience similar to find_package when
# add_subdirectory or FetchContent is used to consume this project
# ---- Declare library ----

add_library(
    perturb SHARED
    src/perturb.cpp src/tle.cpp src/sgp4.cpp
)

target_include_directories(
    perturb ${warning_guard}
    PUBLIC
        $<BUILD_INTERFACE:${PROJECT_SOURCE_DIR}/include>
)

target_compile_features(perturb PUBLIC cxx_std_11)

if(perturb_DISABLE_IO)
    target_compile_definitions(perturb PUBLIC PERTURB_DISABLE_IO)
endif()

